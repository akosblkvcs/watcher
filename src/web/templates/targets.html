{% extends "base.html" %}

{% block title %}Targets - Watcher{% endblock %}

{% block content %}
    <h1>Watch Targets</h1>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>URL</th>
                <th>Selector</th>
                <th>Processor</th>
                <th>Active</th>
                <th>Last Run</th>
                <th>Last Status</th>
                <th>Last Processed</th>
                <th>Last Error</th>
                <th>Duration (ms)</th>
            </tr>
        </thead>
        <tbody>
            {% for t in targets %}
            <tr>
                <td>{{ t.id }}</td>
                <td>{{ t.name }}</td>
                <td><a href="{{ t.url }}" target="_blank" rel="noopener">{{ t.url }}</a></td>
                <td><code>{{ t.selector_type }}: {{ t.selector }}</code></td>
                <td>
                    <code>{{ t.processor_type }}</code>
                    {% if t.processor_config %}
                    <div><code>{{ t.processor_config }}</code></div>
                    {% endif %}
                </td>
                <td>{{ 'yes' if t.active else 'no' }}</td>
                <td>{{ t.last_run_at if t.last_run_at else '' }}</td>
                <td>{{ t.last_status if t.last_status else '' }}</td>
                <td>
                    {% if t.last_processed_text %}
                    <code>{{ t.last_processed_text }}</code>
                    {% endif %}
                </td>
                <td>
                    {% if t.last_error_message %}
                    <code>{{ t.last_error_message }}</code>
                    {% endif %}
                </td>
                <td>{{ t.last_duration_ms if t.last_duration_ms else '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
